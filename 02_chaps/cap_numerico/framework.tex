For the numerical code framework, several classes were created in 
order to reuse the code in further simulations. 
Initially, the triangular unstructured mesh generated by GMSH \cite{gmsh}
was imported into the numerical code by the \textit{ImportMSH} class.
This class returns important information for the simulation 
such as:
\textit{nodes number} (\textbf{np}), 
\textit{elements number} (\textbf{ne}), 
\textit{the coordinate vectors} (\textbf{x} and \textbf{y}), 
\textit{the connectivity matrix} (\textbf{IEN}),
\textit{the neighbors nodes} and 
\textit{the Boundary nodes}. 
The \textit{ImportMSH} class is 
enabled to import the linear, quadratic or cubic triangular elements.
The \ref{tempo malha} shows the average processing time for 
mesh import in several unstructured linear triangular meshes.

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 0.3 \\
13745 & 26548 & 1.2 \\
53229 & 105656 & 4.7 \\
148187 & 295036 & 14.2 \\
\bottomrule
\end{tabular}
\caption{Average processing time for mesh import in several unstructured linear triangular meshes}
\label{tempo malha}
\end{table}

\medskip
After importing the \textit{.msh} file, the elementary and global matrices 
were assembled. 
They are created by the \textit{GaussianQuadrature} class, where it is enabled to assemble the linear, quadratic or cubic triangular element.
For the linear 
triangular element, it is also possible to use elementary 
analytical matrices. For more details consult the work of Lewis, 
Nithiarasu and Seetharamu (2004) \cite{lewis2004}.

\medskip
The global matrix assembly was performed by \textit{Assemble} class, satisfying the local and global matrices index correspondence.
They were initialized as sparse matrices by 
the \textit{Scipy} library \cite{scipy} and 
the \ref{tempo matrizes globais} shows the average processing time 
for global matrices assembly in several unstructured linear 
triangular meshes.

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 18.4 \\
13745 & 26548 & 70.6 \\
53229 & 105656 & 284.3 \\
148187 & 295036 & 815.6 \\



\bottomrule
\end{tabular}
\caption{Average processing time for global matrices assembly in several unstrutured linear triangular meshes}
\label{tempo matrizes globais}
\end{table}


\medskip
Then, the boundary conditions are applied by \textit{BoundaryConditions} class
that contains the boundary conditions
for each benchmark problems of this
work, namely:
\textit{Couette Flow}, 
\textit{Poiseuille Flow}, 
\textit{Half Poiseuille Flow}, 
\textit{Lid-driven Cavity Flow}, 
\textit{Backward-facing Step Flow}, 
\textit{Pulsation Boundary Flow} and
\textit{Drug-eluting Stent Problems}. 
This class is enabled to apply 
the linear, quadrature and cubic boundary elements.
The \ref{tempo contorno} 
shows the average processing time for the \textit{Dirichlet} 
condition apply in several unstructured linear triangular meshes.

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 1.4 \\
13745 & 26548 & 6.7 \\
53229 & 105656 & 26.9 \\
148187 & 295036 & 81.8 \\



\bottomrule
\end{tabular}
\caption{Average processing time for Dirichlet condition in several unstrutured linear triangular meshes}
\label{tempo contorno}
\end{table}
 
\medskip
After boundary condition applied, the time loop is started and
the updating mesh is done by the \textit{MeshUpdate} class.
Subsequently, the coordinate vectors and the global matrices
must be reassembled, in addition to the boundary conditions apply.
The \ref{tempo mesh update} 
shows the average processing time for the \textit{mesh update procedure}
in several unstructured linear triangular meshes.
This processing time does not take into account the global matrices assembly and
boundary conditions apply. These process are performed by the
Assemble and BoundaryCondition classes, as previously mentioned. 

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 0.5 \\
13745 & 26548 & 2.8 \\
53229 & 105656 & 26.8 \\
148187 & 295036 & 384.4 \\



\bottomrule
\end{tabular}
\caption{Average processing time for mesh update procedure in several unstrutured linear triangular meshes}
\label{tempo mesh update}
\end{table}


\medskip
Finally, the Vorticity-Streamfunction solver is done. 
The simulator is enabled to solver the equations using the
\textit{Taylor-Galerkin} and \textit{semi-Lagrangian} Methods.
As previously mentioned, the boundary condition of the vorticity
is calculated for each time step and 
the linear equations system is solver by Scipy Conjugate Gradient.
The simulator is enabled to solver for linear, quadratic and cubic
triangular elements. The \ref{tempo vorticity solver} 
shows the average processing time for the \textit{Vorticity Solver}
and the \ref{tempo semi Lagrangian} 
shows for the \textit{semi-Lagragian} Method.

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 1.3 \\
13745 & 26548 & 5.4 \\
53229 & 105656 & 21.2 \\
148187 & 295036 & 63.5 \\



\bottomrule
\end{tabular}
\caption{Average processing time for Vorticity Solver in several unstrutured linear triangular meshes}
\label{tempo vorticity solver}
\end{table}


\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 0.6 \\
13745 & 26548 & 2.1 \\
53229 & 105656 & 8.5 \\
148187 & 295036 & 24.9 \\



\bottomrule
\end{tabular}
\caption{Average processing time for the semi-Lagrangian method in several unstrutured linear triangular meshes}
\label{tempo semi lagrangian}
\end{table}


\medskip
At the end of time step, the convergence and steady state checks are done.
In addition, the parameters of simulation is printed and
the VTK file is exported to perform the post-processing by
\textit{PARAVIEW} open source \cite{paraview}. 
The \ref{tempo export vtk} 
shows the average processing time for the \textit{VTK file export}
in several unstructured linear triangular meshes.

\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Nodes} & \textbf{Elements} & \textbf{AVG Processing Time} (s) \\
\midrule
3436 & 6670 & 0.1 \\
13745 & 26548 & 0.3 \\
53229 & 105656 & 1.4 \\
148187 & 295036 & 3.9 \\



\bottomrule
\end{tabular}
\caption{Average processing time for VTK file export in several unstrutured linear triangular meshes}
\label{tempo export vtk}
\end{table}

\medskip
Therefore, the \ref{solution algorithm} shows schematically the procedure used
in this numerical simulation.
Moreover, the \ref{time ratio} shows the average time ratio
of the numerical code process for the 12345 linear triangular elements. 
It can be seen that 
the assembly process is the highest processing time
and to improve the code performance, improvements are expected.



\vspace{0.5cm}
% Define block styles
\tikzstyle{block} = [rectangle, draw, fill=gray!10!,
    text width=25em, text centered, draw,scale=0.7,text=black!90!]
\tikzstyle{line} = [draw, -latex',scale=0.75]



\begin{figure}[h!]
\begin{center}
\begin{tikzpicture}[node distance = 1.0cm,auto]
    % Place nodes
    \node [block] (step1) {Import mesh};
    \node [block, below of=step1] (step2) {Calculate Gaussian Quadradure and Assemble Matrix};
    \node [block, below of=step2] (step3) {Inicialize Vorticity and Streamfunction};
    \node [block, below of=step3] (step4) {Calculate Laplacian smoothing and ALE velocity};
    \node [block, below of=step4] (step5) {Move Nodes};
    \node [block, below of=step5] (step6) {Calculate Gaussian Quadradure and Assemble Matrix};
    \node [block, below of=step6] (step7) {Calculate vorticity boundary condition};
    \node [block, below of=step7] (step8) {Calculate semi-Lagrangian and Vorticity field};
    \node [block, below of=step8] (step9) {Calculate streamfunction field};
    \node [block, below of=step9] (step10) {Calculate velocity field};
    \node [block, below of=step10] (step11) {Calculate concentration field};
    \node [right of=step4, node distance=4cm] (initialLoop) {};
    \node [right of=step11, node distance=4cm] (finalLoop) {};
    \node [right of=step7, node distance=5.5cm] (textLoop) {};

    \node [draw=none, align=center,scale=0.7,text=black!80!] at (textLoop) {Repeat the procedure \\ for the next time step \\ until the steady state};
    % Draw edges
    \path [line] (step1) -- (step2);
    \path [line] (step2) -- (step3);
    \path [line] (step3) -- (step4);
    \path [line] (step4) -- (step5);
    \path [line] (step5) -- (step6);
    \path [line] (step6) -- (step7);
    \path [line] (step7) -- (step8);
    \path [line] (step8) -- (step9);
    \path [line] (step9) -- (step10);
    \path [line] (step10) -- (step11);
    \path [line,dashed] (step11) -- (finalLoop) -- (initialLoop) |- (step4);
\end{tikzpicture}
\end{center}
\caption{Solve algorithm for Vorticity-Streamfunction Formulation with Species Transport Equation}
\label{solution algorithm} 
\end{figure}  



\vspace{0.5cm}
\begin{table}[H]
\centering
\begin{tabular}{ccc}
\toprule
\textbf{Process} & \textbf{AVG Time Ratio} (\%) \\
\midrule
10482 & 6,8 \\
40819 & 37,5 \\
249677 & 467,7 \\
993091 & 3720,6 \\
\bottomrule
\end{tabular}
\caption{Average time ratio of the numerical code process for 12345 linear triangular elements.}
\label{time ratio}
\end{table}



